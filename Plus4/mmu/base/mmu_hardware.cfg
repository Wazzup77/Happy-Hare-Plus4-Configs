########################################################################################################################
# Happy Hare MMU Software
#
# EDIT THIS FILE BASED ON YOUR SETUP
#
# Copyright (C) 2022-2025  moggieuk#6538 (discord)
#                          moggieuk@hotmail.com
# This file may be distributed under the terms of the GNU GPLv3 license.
#
# Goal: Happy Hare MMU hardware config file with config for BTT ViViD MCU board
#
# (\_/)
# ( *,*)
# (")_(") Happy Hare Ready
#
#
# Notes about setup of common external MCUs can be found here:
#  https://github.com/moggieuk/Happy-Hare/blob/main/doc/mcu_notes.md
# 
# Note about "touch" endstops: Happy Hare provides extremely flexible homing options using both single steppers or
# synced steppers. The "touch" option leverages stallguard and thus requires the appropriate 'diag_pin' and stallguard
# parameters set on the TMC driver section. If you have the diag_pin exposed, it is harmless to define this because
# they will only be used when explicitly needed and configured.
#
# Touch option for each stepper provides these benefits / possibilities (experimental):
#  - on extruder stepper allows for the automatic detection of the nozzle!
#  - on selector stepper allows for the automatic detection of filament stuck in the gate and subsequent recovery
#  - on gear stepper allows for the automatic detection of the extruder entrance
#
# In summary, "touch" homing with your MMU is an advanced option that requires patience and careful tuning. Everything
# works with regular endstops and there are workaround options for certain homing points (like extruder entry) in
# the absence of any endstop. I'm really interested in creative setups. Ping me on Discord (moggieuk#6538)
#
# See 'mmu.cfg' for serial definition and pins aliases
#
# HOMING CAPABLE EXTRUDER (VERY ADVANCED) -----------------------------------------------------------------------------
# With Happy Hare installed even the extruder can be homed. You will find the usual 'endstop' parameters can be added
# to your '[extruder]' section.  Useless you have some clever load cell attached to your nozzle it only really makes
# sense to configure stallguard style "touch" homing. To do this add lines similar to this to your existing
# '[extruder]' definition in printer.cfg.
#
#    [extruder]
#    endstop_pin: tmc2209_extruder:virtual_endstop
#
# Also be sure to add the appropriate stallguard config to the TMC section, e.g.
#
#    [tmc2209 extruder]
#    diag_pin: E_DIAG		# Set to MCU pin connected to TMC DIAG pin for extruder
#    driver_SGTHRS: 100		# 255 is most sensitive value, 0 is least sensitive
#
# Happy Hare will take care of the rest and add a 'mmu_ext_touch' endstop automatically
#


# MMU MACHINE / TYPE ---------------------------------------------------------------------------------------------------
# ███╗   ███╗███╗   ███╗██╗   ██╗    ███╗   ███╗ █████╗  ██████╗██╗  ██╗██╗███╗   ██╗███████╗
# ████╗ ████║████╗ ████║██║   ██║    ████╗ ████║██╔══██╗██╔════╝██║  ██║██║████╗  ██║██╔════╝
# ██╔████╔██║██╔████╔██║██║   ██║    ██╔████╔██║███████║██║     ███████║██║██╔██╗ ██║█████╗  
# ██║╚██╔╝██║██║╚██╔╝██║██║   ██║    ██║╚██╔╝██║██╔══██║██║     ██╔══██║██║██║╚██╗██║██╔══╝  
# ██║ ╚═╝ ██║██║ ╚═╝ ██║╚██████╔╝    ██║ ╚═╝ ██║██║  ██║╚██████╗██║  ██║██║██║ ╚████║███████╗
# ╚═╝     ╚═╝╚═╝     ╚═╝ ╚═════╝     ╚═╝     ╚═╝╚═╝  ╚═╝ ╚═════╝╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝╚══════╝
[mmu_machine]

# Number of selectable gate on (each) MMU. Generally this is a single number, but with multi-mmu (type-B) setups
# it can be a comma separated list of the number of gates per unit.
# E.g. 'num_gates: 4,4,2' for a 2xBox Turtle and 1xNight Owl multiplexed setup
#
num_gates: 4

# MMU Vendor & Version is used to automatically configure some parameters and validate configuration
# If custom set to "Other" and uncomment the additional parameters below
#
mmu_vendor: Other				# MMU family
mmu_version: 1.0			# MMU hardware version number (add mod suffix documented above)

# The following attributes are set internally from vendor/version above. Only uncomment to customize the vendor
# default or for custom ("Other") designs
#
selector_type: VirtualSelector		# E.g. LinearSelector (type-A), VirtualSelector (type-B), MacroSelector, RotarySelector, ...
variable_bowden_lengths: 0		# 1 = If MMU design has different bowden lengths per gate, 0 = bowden length is the same
variable_rotation_distances: 0		# 1 = If MMU design has dissimilar drive/BMG gears, thus rotation distance, 0 = One drive gear (e.g. Tradrack)
require_bowden_move: 1			# 1 = If MMU design has bowden move that is included in load/unload, 0 = zero length bowden (skip bowden move)
filament_always_gripped: 1		# 1 = Filament is always trapped by MMU (most type-B designs), 0 = MMU can release filament
has_bypass: 0				# 1 = Bypass gate available, 0 = No filament bypass possible

# Uncomment to change the display name in UI's.  Defaults to the vendor name
#display_name: My Precious

# Fullname of environment sensor for MMU filament storage (displays temp and humidity in UI)
# Polls for "temperature" and "humidity"
# E.g. If you have a section like this: [temperature_sensor MMU_enclosure]
# Set: environment_sensor: temperature_sensor MMU_enclosure

environment_sensor: temperature_sensor box1_heater:sensor

homing_extruder: 1			# CAUTION: Normally this should be 1. 0 will disable the homing extruder capability


# FILAMENT DRIVE GEAR STEPPER(S) --------------------------------------------------------------------------------------
#  ██████╗ ███████╗ █████╗ ██████╗
# ██╔════╝ ██╔════╝██╔══██╗██╔══██╗
# ██║  ███╗█████╗  ███████║██████╔╝
# ██║   ██║██╔══╝  ██╔══██║██╔══██╗
# ╚██████╔╝███████╗██║  ██║██║  ██║
#  ╚═════╝ ╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝
#
# Note that 'toolhead' & 'mmu_gear' endstops will automatically be added if a toolhead sensor or gate sensor is defined
#
[stepper_mmu_gear]
step_pin: mmu:PC14
dir_pin: mmu:PC13
enable_pin: !mmu:PC15
rotation_distance: 13.6
step_pulse_duration:0.000000100
microsteps: 16 				# Recommend 16. Increase only if you "step compress" issues when syncing

#[tmc2209 stepper_mmu_gear]
#uart_pin: mmu:PA10
#tx_pin: mmu:PA9
#uart_address: 0
#run_current: 1.2


# Uncomment the two lines below to enable filament "touch" homing option with gear motor
#extra_endstop_pins: tmc2209_stepper_mmu_gear:virtual_endstop
#extra_endstop_names: mmu_gear_touch

# ADDITIONAL FILAMENT DRIVE GEAR STEPPERS FOR TYPE-B MMU's -------------------------------------------------------------
# Note that common parameters are inherited from base stepper_mmu_gear, but can be uniquely specified here too
#
# Filament Drive Gear_1 --------------------------

[stepper_mmu_gear_1]
step_pin: mmu:PB9
dir_pin: mmu:PB8
enable_pin: !mmu:PC0
rotation_distance: 13.6
step_pulse_duration:0.000000100
microsteps: 16 				# Recommend 16. Increase only if you "step compress" issues when syncing

#[tmc2209 stepper_mmu_gear_1]
#uart_pin: mmu:PA10
#tx_pin: mmu:PA9
#uart_address: 1
#run_current: 1.2


# Filament Drive Gear_2 --------------------------

[stepper_mmu_gear_2]
step_pin: mmu:PC12
dir_pin: mmu:PC11
enable_pin: !mmu:PD2
rotation_distance: 13.6
step_pulse_duration:0.000000100
microsteps: 16 				# Recommend 16. Increase only if you "step compress" issues when syncing

#[tmc2209 stepper_mmu_gear_2]
#uart_pin: mmu:PA10
#tx_pin: mmu:PA9
#uart_address: 2
#run_current: 1.2


# Filament Drive Gear_3 --------------------------

[stepper_mmu_gear_3]
step_pin: mmu:PC8
dir_pin: mmu:PB2
enable_pin: !mmu:PC10
rotation_distance: 13.6
step_pulse_duration:0.000000100
microsteps: 16 				# Recommend 16. Increase only if you "step compress" issues when syncing

#[tmc2209 stepper_mmu_gear_3]
#uart_pin: mmu:PA10
#tx_pin: mmu:PA9
#uart_address: 3
#run_current: 1.2

# SELECTOR STEPPER ----------------------------------------------------------------------------------------------------
# ███████╗███████╗██╗     ███████╗ ██████╗████████╗ ██████╗ ██████╗ 
# ██╔════╝██╔════╝██║     ██╔════╝██╔════╝╚══██╔══╝██╔═══██╗██╔══██╗
# ███████╗█████╗  ██║     █████╗  ██║        ██║   ██║   ██║██████╔╝
# ╚════██║██╔══╝  ██║     ██╔══╝  ██║        ██║   ██║   ██║██╔══██╗
# ███████║███████╗███████╗███████╗╚██████╗   ██║   ╚██████╔╝██║  ██║
# ╚══════╝╚══════╝╚══════╝╚══════╝ ╚═════╝   ╚═╝    ╚═════╝ ╚═╝  ╚═╝
#
# Consult doc if you want to setup selector for "touch" homing instead or physical endstop
#
#[tmc2209 stepper_mmu_selector]
#uart_pin: mmu:PB3
#run_current: 0.8
#hold_current: 0.4			# Recommend to be small if not using "touch" or move (TMC stallguard)
#interpolate: True
#sense_resistor: 0.110			# Usually 0.11, 0.15 for BTT TMC2226
#stealthchop_threshold: 0		# Spreadcycle has more torque and better at speed

#[stepper_mmu_selector]
#step_pin: mmu:PD3
#dir_pin: mmu:PD2
#enable_pin: !mmu:PB4
#rotation_distance: 360
#gear_ratio: 25:10
#microsteps: 16 				# Don't need high fidelity
#full_steps_per_rotation: 200		# 200 for 1.8 degree, 400 for 0.9 degree
#extra_endstop_pins: !mmu:PD0, !mmu:PA15, !mmu:PD1, !mmu:PC13
#extra_endstop_names: unit0_gate0, unit0_gate1, unit0_gate2, unit0_gate3


# ENCODER -------------------------------------------------------------------------------------------------------------
# ███████╗███╗   ██╗ ██████╗ ██████╗ ██████╗ ███████╗██████╗ 
# ██╔════╝████╗  ██║██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔══██╗
# █████╗  ██╔██╗ ██║██║     ██║   ██║██║  ██║█████╗  ██████╔╝
# ██╔══╝  ██║╚██╗██║██║     ██║   ██║██║  ██║██╔══╝  ██╔══██╗
# ███████╗██║ ╚████║╚██████╗╚██████╔╝██████╔╝███████╗██║  ██║
# ╚══════╝╚═╝  ╚═══╝ ╚═════╝ ╚═════╝ ╚═════╝ ╚══════╝╚═╝  ╚═╝
# Encoder measures distance, monitors for runout and clogging and constantly calculates % flow rate
# with the value stored in mmu_vars.cfg
#
# The encoder resolution will be calibrated but it needs a default approximation 
# If BMG gear based:
#   resolution = bmg_circumfrance / (2 * teeth)
# 24 / (2 * 17) = 0.7059 for TRCT5000 based sensor
# 24 / (2 * 12) = 1.0 for Binky with 12 tooth disc
#
[mmu_encoder mmu_encoder]
encoder_pin: ^mmu:PB0
encoder_resolution: 3.0			# This is just a starter value. Overriden by calibrated 'mmu_encoder_resolution' in mmm_vars.cfg
desired_headroom: 5.0			# The clog/runout headroom that MMU attempts to maintain (closest point to triggering runout)
average_samples: 4			# The "damping" effect of last measurement (higher value means slower automatic clog_length reduction)
flowrate_samples: 20			# How many "movements" of the extruder to measure average flowrate over


# SERVOS ---------------------------------------------------------------------------------------------------------------
# ███████╗███████╗██████╗ ██╗   ██╗ ██████╗ ███████╗
# ██╔════╝██╔════╝██╔══██╗██║   ██║██╔═══██╗██╔════╝
# ███████╗█████╗  ██████╔╝██║   ██║██║   ██║███████╗
# ╚════██║██╔══╝  ██╔══██╗╚██╗ ██╔╝██║   ██║╚════██║
# ███████║███████╗██║  ██║ ╚████╔╝ ╚██████╔╝███████║
# ╚══════╝╚══════╝╚═╝  ╚═╝  ╚═══╝   ╚═════╝ ╚══════╝
# Basic servo PWM setup. If these values are changed then the angles defined for different positions will also change
#
# OPTIONAL GANTRY SERVO FOR TOOLHEAD FILAMENT CUTTER ------------------------------------------------------------------
#
# (uncomment this section if you have a gantry servo for toolhead cutter pin)
#[mmu_servo mmu_gantry_servo]
#pin: 
#maximum_servo_angle:180
#minimum_pulse_width: 0.00075
#maximum_pulse_width: 0.00225
#initial_angle: 180

# FILAMENT SENSORS -----------------------------------------------------------------------------------------------------
# ███████╗███████╗███╗   ██╗███████╗ ██████╗ ██████╗ ███████╗
# ██╔════╝██╔════╝████╗  ██║██╔════╝██╔═══██╗██╔══██╗██╔════╝
# ███████╗█████╗  ██╔██╗ ██║███████╗██║   ██║██████╔╝███████╗
# ╚════██║██╔══╝  ██║╚██╗██║╚════██║██║   ██║██╔══██╗╚════██║
# ███████║███████╗██║ ╚████║███████║╚██████╔╝██║  ██║███████║
# ╚══════╝╚══════╝╚═╝  ╚═══╝╚══════╝ ╚═════╝ ╚═╝  ╚═╝╚══════╝
# Define the pins for optional sensors in the filament path. All but the pre-gate sensors will be automatically setup as
# both endstops (for homing) and sensors for visibility purposes.
#
# 'pre_gate_switch_pin_X'  .. 'mmu_pre_gate_X' sensor detects filament at entry to MMU. X=gate number (0..N)
# 'gate_switch_pin'        .. 'mmu_gate' shared sensor detects filament past the gate of the MMU
#     or
# 'post_gear_switch_pin_X' .. 'mmu_gear_X' post gear sensor for each filament
# 'extruder_switch_pin'    .. 'extruder' sensor detects filament just before the extruder entry
# 'toolhead_switch_pin'    .. 'toolhead' sensor detects filament after extruder entry
#
# Sync motor feedback will typically have a tension switch (most important for syncing) or both tension and compression.
# Note that compression switch is useful for use as a endstop to detect hitting the extruder entrance
# 'sync_feedback_tension_pin'     .. pin for switch activated when filament is under tension
# 'sync_feedback_compression_pin' .. pin for switch activated when filament is under compression
#
# Configuration is flexible: Simply define pins for any sensor you want to enable, if pin is not set (or the alias is empty)
# it will be ignored. You can also just comment out what you are not using.
#
[mmu_sensors]
pre_gate_switch_pin_0: !mmu:PA0
pre_gate_switch_pin_1: !mmu:PB3
pre_gate_switch_pin_2: !mmu:PA13
pre_gate_switch_pin_3: !mmu:PA7

gate_switch_pin: ^!mmu:PB1

# Hall sensor implementation uses parameters from stock klipper hall_filament_width_sensor.
# An additional param 'hall_sensor_endstop' denotes the mounting spot of the hall sensor:
#  'gate' - sensor detects filament just after gate
#  'extruder' - sensor detects filament just before extruder gears
#  'toolhead' - sensor detects filament after extruder gears

hall_sensor_endstop: extruder
hall_adc1: PA2
hall_adc2: PA3
hall_cal_dia1: 1.50
hall_cal_dia2: 2.0
hall_raw_dia1: 14197
hall_raw_dia2: 15058
hall_default_nominal_filament_diameter: 1.75
hall_max_difference: 0.2
hall_measurement_interval: 10
hall_measurement_delay: 50
hall_logging: False
hall_min_diameter: 0.3
hall_max_diameter: 2
hall_extrusion_factor_compensation: false


# ESPOOLER (OPTIONAL) -------------------------------------------------------------------------------------------------
# ███████╗███████╗██████╗  ██████╗  ██████╗ ██╗     ███████╗██████╗
# ██╔════╝██╔════╝██╔══██╗██╔═══██╗██╔═══██╗██║     ██╔════╝██╔══██╗
# █████╗  ███████╗██████╔╝██║   ██║██║   ██║██║     █████╗  ██████╔╝
# ██╔══╝  ╚════██║██╔═══╝ ██║   ██║██║   ██║██║     ██╔══╝  ██╔══██╗
# ███████╗███████║██║     ╚██████╔╝╚██████╔╝███████╗███████╗██║  ██║
# ╚══════╝╚══════╝╚═╝      ╚═════╝  ╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝
#
# An espooler controls DC motors (typically N20) that are able to rewind a filament spool and optionally provide
# forward assist to overcome spooler rotation friction. This should define pins for each of the gates on your mmu
# starting with '_0'.
# An empty pin can be deleted, commented or simply left blank. If you mcu has a separate "enable" pin
#
#[mmu_espooler mmu_espooler]
#pwm: 1						# 1=PWM control (typical), 0=digital on/off control
##hardware_pwm: 0				# See klipper doc
##cycle_time: 0.100				# See klipper doc
#scale: 1					# Scales the PWM output range
#value: 0					# See klipper doc
#shutdown_value: 0				# See klipper doc
#
#respool_motor_pin_0: mmu:MMU_ESPOOLER_RWD_0	# PWM (or digital) pin for rewind/respool movement
#assist_motor_pin_0: mmu:MMU_ESPOOLER_FWD_0	# PWM (or digital) pin for forward motor movement
#enable_motor_pin_0: mmu:MMU_ESPOOLER_EN_0	# Digital output for Afc mcu
#assist_trigger_pin_0: mmu:MMU_ESPOOLER_TRIG_0	# Trigger pin for sensing need to assist during print
#
#respool_motor_pin_1: mmu:MMU_ESPOOLER_RWD_1
#assist_motor_pin_1: mmu:MMU_ESPOOLER_FWD_1
#enable_motor_pin_1: mmu:MMU_ESPOOLER_EN_1
#assist_trigger_pin_1: mmu:MMU_ESPOOLER_TRIG_1
#
#respool_motor_pin_2: mmu:MMU_ESPOOLER_RWD_2
#assist_motor_pin_2: mmu:MMU_ESPOOLER_FWD_2
#enable_motor_pin_2: mmu:MMU_ESPOOLER_EN_2
#assist_trigger_pin_2: mmu:MMU_ESPOOLER_TRIG_2
#
#respool_motor_pin_3: mmu:MMU_ESPOOLER_RWD_3
#assist_motor_pin_3: mmu:MMU_ESPOOLER_FWD_3
#enable_motor_pin_3: mmu:MMU_ESPOOLER_EN_3
#assist_trigger_pin_3: mmu:MMU_ESPOOLER_TRIG_3


# LED SUPPORT (OPTIONAL) -----------------------------------------------------------------------------------------------
# ██╗     ███████╗██████╗ ███████╗
# ██║     ██╔════╝██╔══██╗██╔════╝
# ██║     █████╗  ██║  ██║███████╗
# ██║     ██╔══╝  ██║  ██║╚════██║
# ███████╗███████╗██████╔╝███████║
# ╚══════╝╚══════╝╚═════╝ ╚══════╝
#
# Define mmu leds, both the "neopixel" config and [mmu_led] to define their purpose
#

# The Qidi Box does not use neopixels, it has a RED and WHITE diode on each channel (i.e. 2 x 4 = 8 LEDs)
# We map them as 4 RBG leds, where the RED LED is the red channel, WHITE LED is the green channel and blue is unused
# So in terms of colors (1, 0, 0) would be red, (0, 1, 0) would be white. Do not use blue.

[led qidi_slot_0]
red_pin: mmu:PA2
green_pin: mmu:PA1  # NOTE: Actually white pin (mapped to green channel)
initial_red: 0.0
initial_green: 0.0

[led qidi_slot_1]
red_pin: mmu:PB5
green_pin: mmu:PB4  # NOTE: Actually white pin (mapped to green channel)
initial_red: 0.0
initial_green: 0.0

[led qidi_slot_2]
red_pin: mmu:PA15
green_pin: mmu:PA14  ## NOTE: Actually white pin (mapped to green channel)
initial_red: 0.0
initial_green: 0.0

[led qidi_slot_3]
red_pin: mmu:PC5
green_pin: mmu:PC4  # NOTE: Actually white pin (mapped to green channel)
initial_red: 0.0
initial_green: 0.0


[mmu_leds unit0]
# We construct a virtual chain by listing the 4 separate LED objects.
# THe Qidi Box does not use neopixels, it uses discrete LEDs (red and white), so the chains have 1 pixel
exit_leds:
    led:qidi_slot_0 (1)
    led:qidi_slot_1 (1)
    led:qidi_slot_2 (1)
    led:qidi_slot_3 (1)

enabled: True				# True = LEDs are enabled at startup (MMU_LED can control), False = Disabled
animation: True				# True = Use led-animation-effects, False = Static LEDs

black_light: (1, 0, 0)   # RGB color used to represent "black" (filament)
white_light: (0, 1, 0)   # RGB color for static white light
empty_light: (0, 0, 0)   # RGB color used to represent empty gate

exit_effect: gate_status		#    off|gate_status|filament_color|slicer_color|r,g,b|_effect_

# All states must have a designation. Animations are defined below, the RGB designation is the alternative used if animation: False
# From testing possible colors seem to be:
# (1,0,0)     - pure read
# (0,1,0)     - pure white
# (1, 0.3, 0) - somewhat pink, depending on the viewing angle
#
# Customize this at will. From what I saw all effects should be defined.

# state                     animation               static backup (if animation: False)
effect_loading:            mmu_white_fast,          (0, 1, 0)
effect_loading_extruder:   mmu_white_fast,          (0, 1, 0)
effect_unloading:          mmu_white_fast,          (0, 1, 0)
effect_unloading_extruder: mmu_white_fast,          (0, 1, 0)
effect_heating:            mmu_red_breathing,       (1, 0, 0)
effect_selecting:          mmu_white_fast,          (0, 1, 0)
effect_checking:           mmu_white_fast,          (0, 1, 0)
effect_initialized:        mmu_white_blink,         (0, 1, 0)
effect_error:              mmu_red_fast,            (1, 0, 0)
effect_complete:           mmu_sparkle,             (0, 1, 0)
effect_gate_selected:      mmu_white_breathing,     (0, 1, 0)
effect_gate_available:     mmu_white_dim,           (0, 0.2, 0)
effect_gate_available_sel: mmu_white_breathing,     (0, 1, 0)
effect_gate_unknown:       mmu_red_breathing,       (1, 0, 0)
effect_gate_unknown_sel:   mmu_red_breathing,       (1, 0, 0)
effect_gate_empty:         mmu_black,               (0, 0, 0)
effect_gate_empty_sel:     mmu_black,               (0, 0, 0)

# Qidi Box specific LED effects defined below
# Customize this at will, creating new effects. Some stock effects are defined in mmu_leds.cfg.

[mmu_led_effect mmu_black]
layers:       static 0 0 top (0,0,0)

[mmu_led_effect mmu_red_breathing]
layers:       breathing 4 0 top (1,0,0)

[mmu_led_effect mmu_white_breathing]
layers:       breathing 4 0 top (0,1,0)

[mmu_led_effect mmu_red_fast]
layers:       breathing 0.6 0 top (1,0,0)

[mmu_led_effect mmu_white_fast]
layers:       breathing 0.6 0 top (0,1,0)

[mmu_led_effect mmu_red_blink]
layers:       blink 1 0 top (1,0,0)

[mmu_led_effect mmu_white_blink]
layers:       blink 1 0 top (0,1,0)

[mmu_led_effect mmu_red_static]
layers:       static 0 0 top (1,0,0)

[mmu_led_effect mmu_white_static]
layers:       static 0 0 top (0,1,0)

[mmu_led_effect mmu_white_dim]
layers:       static 0 0 top (0,0.3,0)

[mmu_led_effect mmu_pink_static]
layers:       static 0 0 top (1,0.3,0)

# ADDITIONAL HARDWARE -------------------------------------------------------------------------------------------------
# ███╗   ███╗██╗███████╗ ██████╗    ██╗  ██╗ █████╗ ██████╗ ██████╗ ██╗    ██╗ █████╗ ██████╗ ███████╗
# ████╗ ████║██║██╔════╝██╔════╝    ██║  ██║██╔══██╗██╔══██╗██╔══██╗██║    ██║██╔══██╗██╔══██╗██╔════╝
# ██╔████╔██║██║███████╗██║         ███████║███████║██████╔╝██║  ██║██║ █╗ ██║███████║██████╔╝█████╗  
# ██║╚██╔╝██║██║╚════██║██║         ██╔══██║██╔══██║██╔══██╗██║  ██║██║███╗██║██╔══██║██╔══██╗██╔══╝  
# ██║ ╚═╝ ██║██║███████║╚██████╗    ██║  ██║██║  ██║██║  ██║██████╔╝╚███╔███╔╝██║  ██║██║  ██║███████╗
# ╚═╝     ╚═╝╚═╝╚══════╝ ╚═════╝    ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚═════╝  ╚══╝╚══╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝
#
# Define any additional hardware for this MMU unit, e.g. heaters, chamber temperature probes, etc
#

[temperature_sensor box1_temperature]
sensor_type: AHT20_F
i2c_bus: i2c3
i2c_mcu: mmu
i2c_address: 56

[heater_generic box1_heater]
heater_pin: mmu:PA3
sensor_type: AHT20_F
i2c_bus: i2c3
#i2c_software_scl_pin = mcu_box1:PA8
#i2c_software_sda_pin = mcu_box1:PC9
i2c_mcu: mmu
i2c_address: 56
min_temp: -100
max_temp: 100
target_max_temp: 90
control: pid   
pid_Kp: 63.418
pid_Ki: 1.342
pid_Kd: 749.125

[verify_heater box1_heater]
max_error: 400
check_gain_time: 600
is_box_heater: True

[temperature_sensor box1_heater_temp_a]
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: mmu:PC1
min_temp: -100
max_temp: 130

[temperature_sensor box1_heater_temp_b]
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: mmu:PC2
min_temp: -100
max_temp: 130

[heater_fan box1_heater_fan_a_box1]
pin:mmu:PA4
heater_temp: 65
kick_start_time: 0.5
heater: box1_heater
shutdown_speed:1

[heater_fan box1_heater_fan_b]
pin:mmu:PA5
heater_temp: 65
kick_start_time: 0.5
heater: box1_heater
shutdown_speed:1

[controller_fan box1_board_fan]
pin: mmu:PA6
heater: box1_heater
stepper: stepper_mmu_gear, stepper_mmu_gear_1, stepper_mmu_gear_2, stepper_mmu_gear_3

[temperature_sensor Box1_STM32]
sensor_type: temperature_mcu
sensor_mcu: mmu